\documentclass[a4paper,12pt,brazil]{article}

\usepackage[T1]{fontenc}
\usepackage[latin1]{inputenc}
\usepackage[brazil]{babel}
\usepackage{float}

\flushbottom

\setlength\textwidth{160mm}
\setlength\textheight{247mm}
\setlength\hoffset{-13.4mm}
\setlength\voffset{-20mm}
\setlength\parindent{0.75cm}
\setlength\parskip{0mm}
\setlength\topsep{12pt}

\usepackage{paralist}
\usepackage{subfigure}
\usepackage{amsmath,amssymb,amsfonts,textcomp, bm}
\usepackage{rawfonts}
\usepackage{graphics,psfrag}
\usepackage{latexsym}
\usepackage{varioref}
\usepackage{subfigmat}
\usepackage[usenames,dvipsnames]{xcolor}
\usepackage[colorlinks,citecolor=Fuchsia,urlcolor=blue,linkcolor=black]{hyperref}
%\usepackage[colorlinks=false]{hyperref}
\usepackage{color}
\usepackage{array}
\usepackage{hhline}
\usepackage{array}
\usepackage{supertabular}
\usepackage{setspace}
\usepackage[pdftex]{graphicx}
\usepackage{special-char}

\usepackage[sort=def, nopostdot]{glossaries}
\usepackage{makeidx} 
\usepackage{listings}
\usepackage{multicol}
\usepackage{hyperref}

\renewcommand*{\glossarypreamble}{\vspace{-\baselineskip}}  

\newglossary[cng]{conventions}{cns}{cno}{Convenções de notação}
\newglossary[syg]{symbols}{sys}{syo}{Lista de símbolos}

\renewcommand*{\arraystretch}{1.3}  % sets the line indent in glossaries
\setlength{\glsdescwidth}{390pt}   
\setlength\LTleft{0pt}

\renewcommand*{\glossarypreamble}{\vspace{-\baselineskip}}

\makeindex
\makeglossaries

\graphicspath{{figuras/}{../figuras/}}


\begin{document}

\setcounter{MaxMatrixCols}{50}

\onehalfspacing 

\begin{titlepage}
\begin{center}
{\phantom{a}}
\vspace{1.0cm}
\textsc{\Large{{ André Garnier Coutinho}}}\\
\vspace{5.0cm}
 {\huge\bfseries Projeto de Filtro de Kalman Estendido aplicado a um mecanismo serial do tipo RP\\}
\vfill
\hspace{.50\textwidth}
\begin{minipage}{.45\textwidth}
{Relatório sobre observadores de ordem reduzida apresentado à disciplina {\em PME5009 - Introdução à Teoria de Estimação} do Programa de Pós Graduação em Engenharia Mecânica (PPGEM) da Escola Politécnica 
da Universidade de São Paulo (EPUSP)
}\\[25pt]
{Área de concentração:}\\[2pt]
{Engenharia Mecânica}\\[25pt]
{Orientador:}\\[2pt]
Prof. Dr. Tarcisio A. Hess Coelho
\end{minipage}

\vfill
{São Paulo \\ 15 de Abril de 2017}
\end{center}
\end{titlepage}




\vspace{-0.3cm}

\noindent
{\bf Nome: }{André Garnier Coutinho}\\[8pt]
{\bf NUSP: }{6846085}\\[8pt]
{\bf Curso: }{Doutorado Direto}\\[8pt]
{\bf Área de concentração: }{Engenharia Mecânica de Projeto e Fabricação (3151)}\\[8pt]
{\bf Orientador: }{Professor Doutor Tarcisio Antonio Hess Coelho}\\[8pt]
{\bf Ano de ingresso no PPGEM: }{2014}\\[8pt]
{\bf Bolsista: }{Sim}\\[8pt]
{\bf Agência de fomento: }{CNPq}\\[8pt]
{\bf Edital/Chamada: }{Cota Institucional (Demanda Social)}\\[8pt]
{\bf Exame de Qualificação: }{Aprovado em 14/10/2016}\\[8pt]

\vspace{2cm}
\noindent

% ---
% Sumário
% ---
\newpage
\pdfbookmark[0]{\contentsname}{toc}
\tableofcontents
\cleardoublepage
% ---

%RESUMO--------------------------------------------------------   
\newpage
%\section*{Resumo}



%INTRODUÇÃO----------------------------------------------------
%\newpage
\section{Resumo}\label{intro}

Este trabalho se trata do desenvolvimento de uma metodologia de projeto de Filtro de Kalman Estendido discreto-discreto aplicado a mecanismos seriais, supondo modelo dinâmico explícito conhecido. Além disso, será realizada a modelagem dinâmica de um mecanismo serial do tipo RP, no qual será será aplicada a metologia proposta e serão realizadas simulações de controle de trajetória. 



%Formulação--------------------------------------------------------------------
\section{Formulação}\label{formulation}

%Esta se\c{c}\~ao apresenta uma s\'intese dos principais resultados te\'oricos obtidos at\'e o momento.

%\input{symbols}

%---ALGORITMO PARA MODELAGEM DE PLATAFORMAS ROBÓTICAS------------------------------------------------------------------------------------------
\subsection{Modelo dinâmico no espaço de estados}\label{S05-1}

O modelo dinâmico de um mecanismo serial pode ser escrito no seguinte formato \cite{Craig}:
\begin{equation} \label{eq:MecSerial}
\mH(\mq) \ddot{\mq} + \mh(\mq, \dot{\mq}) = \mtau
\end{equation}


Passando para o espaço de estados e definindo como saída do sistema os estados $\mq$, temos:
\begin{equation} \label{eq:SisSS}
\begin{cases}
\begin{bmatrix}
\ddot{\mq} \\
\dot{\mq} \\
\end{bmatrix}
=
\begin{bmatrix}
\mH^{-1}(\mq) \big(\mtau - \mh(\mq,\dot{\mq})\big) \\
\dot{\mq}
\end{bmatrix}

\\
\my = \mq
\end{cases}
\end{equation}

Ou seja:
\begin{equation} \label{eq:SisSSg}
\begin{cases}
\dot{\mx} = \mff(\mx, \muu) \\
\my = \mhh(\mx) \\
\end{cases}
\end{equation}

Sendo:
\begin{equation} \label{eq:x}
\mx = \begin{bmatrix}
\dot{\mq} \\
\mq \\
\end{bmatrix}
\end{equation}
\begin{equation} \label{eq:ff}
\mff( \mx, \muu) = \begin{bmatrix} 
\mH^{-1}(\mq) \big(\mtau - \mh(\mq,\dot{\mq})\big) \\
\dot{\mq}
\end{bmatrix}
\end{equation}
\begin{equation} \label{eq:hh}
\mhh(\mx) = \mq
\end{equation}

\subsection{Modelo dinâmico linearizado}\label{S05-2}

Dado o modelo dinâmico do sistema representado no espaço de estados não linear \eqref{eq:SisSSg}, o modelo linearizado do sistema pode ser obtido realizando a expansão em série de Taylor até primeira ordem das funções $\mff$ e $\mhh$ em torno de um ponto $\mx = \mx^*$, $\muu = \muu^*$. Utilizaremos o superescrito $*$ para indicar que uma função está calculada nessas condições.

\begin{equation}
\mff(\mx, \muu) \approx \mff^* + \frac{\partial \mff}{\partial \mx} \Big|^* \Delta \mx + \frac{\partial \mff}{\partial \muu} \Big|^* \Delta \muu
\end{equation}

\begin{equation}
\mhh(\mx, \muu) \approx \mhh^* + \frac{\partial \mhh}{\partial \mx} \Big|^* \Delta \mx + \frac{\partial \mhh}{\partial \muu} \Big|^* \Delta \muu
\end{equation}

Sendo:
\begin{equation}
\Delta\mx = \mx - \mx^*
\end{equation}
\begin{equation}
\Delta\muu = \muu - \muu^*
\end{equation}

Sabendo-se que:
\begin{equation}
\dot{\mx}^* = \mff^*
\end{equation}
\begin{equation}
\my^* = \mhh^*
\end{equation}

E definindo:
\begin{equation}
\Delta\dot{\mx} = \dot{\mx} - \dot{\mx}^*
\end{equation}
\begin{equation}
\Delta\my = \my - \my^*
\end{equation}
\begin{equation}
\mA = \frac{\partial \mff}{\partial \mx} 
\end{equation}
\begin{equation}
\mB = \frac{\partial \mff}{\partial \muu} 
\end{equation}
\begin{equation}
\mC = \frac{\partial \mhh}{\partial \mx} 
\end{equation}

Obtemos o sistema dinâmico linearizado escrito no espaço de estados linear:
\begin{equation}
\begin{cases}
\Delta\dot{\mx} = \mA^* \cdot \Delta\mx + \mB^* \cdot \Delta\muu \\
\Delta\my = \mC^* \cdot \Delta\mx
\end{cases}
\end{equation}

A expressão de $\mC$ pode ser obtida diretamente sem nem nenhuma dificuldade, visto que a expressão de $\mhh(\mx)$ \eqref{eq:hh} é bem simples para o sistema em questão:

\begin{equation}
\mC = \begin{bmatrix}
\mzr & \mone
\end{bmatrix}
\end{equation}

Devido à complexidade da expressão de $\mff(\mx, \muu)$ \eqref{eq:ff}, as expressões de $\mA$ e $\mB$ serão obtidas de forma implícita. 

A equação \eqref{eq:MecSerial} pode ser reescrita como:
\begin{equation}
\mf(\mq, \dot{\mq}, \ddot{\mq}, \mtau) = \mzr
\end{equation}

Sendo:
\begin{equation}
\mf (\mq, \dot{\mq}, \ddot{\mq}, \mtau) = \mH(\mq) \ddot{\mq} + \mh(\mq, \dot{\mq}) - \mtau
\end{equation}


Para obter o modelo dinâmico linearizado do mecanismo serial, iremos linearizar a função $\mf(\mq, \dot{\mq}, \ddot{\mq}, \mtau)$ em torno de $\mq = \mq^*$, $\dot{\mq} = \dot{\mq}^*$, $\ddot{\mq} = \ddot{\mq}^*$ e $\mtau = \mtau^*$. Utilizaremos o superescrito $*$ para indicar que uma função está calculada nessas condições. Sendo assim, expandindo $\mf$ em Série de Taylor até primeira ordem em torno de $*$, temos:
\begin{equation}
\mf(\mq, \dot{\mq}, \ddot{\mq}, \mtau) \approx  \mf^* + \frac{\partial \mf}{\partial \mq}\Big|^* \Delta \mq + \frac{\partial \mf}{\partial \dot{\mq}}\Big|^* \Delta \dot{\mq} + \frac{\partial \mf}{\partial \ddot{\mq}}\Big|^* \Delta \ddot{\mq} + \frac{\partial \mf}{\partial \mtau}\Big|^* \Delta \mtau
\end{equation}

Sendo:
\begin{equation} \label{eq:G}
\frac{\partial \mf}{\partial \mq} = \mG =  \frac{\partial (\mH \cdot \ddot{\mq})}{\partial \mq} + \frac{\partial \mh}{\partial \mq} 
\end{equation}
\begin{equation} \label{eq:V}
\frac{\partial \mf}{\partial \dot{\mq}} = \mV =  \frac{\partial \mh}{\partial \dot{\mq}}
\end{equation}
\begin{equation} \label{eq:M}
\frac{\partial \mf}{\partial \ddot{\mq}} = \mH
\end{equation}
\begin{equation}
\frac{\partial \mf}{\partial \mtau} = -\mone
\end{equation}
\begin{equation}
\Delta\mq = \mq - \mq^*
\end{equation}
\begin{equation}
\Delta\dot{\mq} = \dot{\mq} - \dot{\mq}^*
\end{equation}
\begin{equation}
\Delta\ddot{\mq} = \ddot{\mq} - \ddot{\mq}^*
\end{equation}
\begin{equation}
\Delta\mtau = \mtau - \mtau^*
\end{equation}

$\mtau^*$ é escolhido de modo que $\mf^* = \mzr$, ou seja:
\begin{equation} \label{eq:tau_d}
\mtau^* = \mH^*  \cdot  \ddot{\mq}^* + \mh^*
\end{equation}

Assim, o modelo linearizado do mecanismo é dado por:
\begin{equation} \label{eq:SisLin}
\mH^* \cdot \Delta\ddot{\mq} + \mV^* \cdot \Delta\dot{\mq} + \mG^* \cdot \Delta\mq = \Delta\mtau
\end{equation}

Passando para o espaço de estados, temos:
\begin{equation} \label{eq:SisLinSS}
\begin{bmatrix}
\Delta\ddot{\mq} \\
\Delta\dot{\mq} \\
\end{bmatrix}
=
\begin{bmatrix}
-{\mH^*}^{-1} \mV^* & -{\mH^*}^{-1} \mG^* \\
\mone & \mzr
\end{bmatrix}
\begin{bmatrix}
\Delta\dot{\mq} \\
\Delta\mq \\
\end{bmatrix}
+
\begin{bmatrix}
{\mH^*}^{-1} \\
\mzr
\end{bmatrix} \Delta\mtau
\end{equation}

Ou seja:
\begin{equation}
\Delta\dot{\mx} = \mA^* \cdot \Delta\mx + \mB^* \cdot \Delta\muu \\
\end{equation}

Sendo:
\begin{equation} \label{eq:x}
\Delta\mx = \begin{bmatrix}
\Delta\dot{\mq} \\
\Delta\mq \\
\end{bmatrix}
\end{equation}
\begin{equation} \label{eq:A}
\mA = \begin{bmatrix}
-\mH^{-1} \mV& -\mH^{-1} \mG \\
\mone & \mzr
\end{bmatrix}
\end{equation}
\begin{equation}
\mB = \begin{bmatrix}
\mH^{-1} \\
\mzr
\end{bmatrix}
\end{equation}

\subsection{Modelo dinâmico discretizado}\label{S05-3}

Como já foi visto anteriormente, o modelo dinâmico de um mecanismo serial no espaço de estado não linear pode ser dado por:

\begin{equation} \tag{\ref{eq:SisSSg}}
\begin{cases}
\dot{\mx} = \mff(\mx, \muu) \\
\my = \mhh(\mx) \\
\end{cases}
\end{equation}

Supondo que a entrade de controle $\muu$ é atualizada a cada $T$ segundos (controle em tempo discreto), temos que o sistema dinâmico discretizado pode ser dado pela seguinte expressão:

\begin{equation}
\begin{cases}
\mx_{k+1} = \mgg(\mx_k, \muu_k) \\
\my_{k+1} = \mhh(\mx_{k+1}) \\
t_{k+1} = t_k + T
\end{cases}
\end{equation}

Em sistemas não lineares a expressão de $\mgg(\mx_k, \muu_k)$ em geral não pode ser obtidade de forma exata, dado que a maioria dos sistemas de equações diferenciais não lineares não possui solução exata. Sendo assim, $\mgg( \mx_k, \muu_k)$ deve ser obtida pela através de métodos numéricos de soluçãos de EDOs. Neste trabalho iremos utilizar um Runge-Kutta de ordem 4 para realizar a discretização do sistema. Sendo assim, obtemos a seguinte expressão para $\mgg( \mx_k, \muu_k)$:

\begin{equation} \label{eq:g}
\mgg(\mx_k, \muu_k) = \mx_k + \frac{T}{6} \Big( \mk_{1 | k} + 2 \mk_{2 | k} + 2 \mk_{3 | k} + \mk_{4 | k} \Big)
\end{equation}

Sendo

\begin{align}
\mk_{1 | k} &=  \mff(\mx_k, \muu_k) \\
\mk_{2 | k} &=  \mff \Big( \mx_k + \frac{T}{2} \mk_{1 | k}, \muu_k \Big) \\
\mk_{3 | k} &=  \mff \Big(  \mx_k + \frac{T}{2} \mk_{2 | k}, \muu_k \Big) \\
\mk_{4 | k} &=  \mff( \mx_k + T \mk_{3 | k}, \muu_k)
\end{align}

\subsection{Jacobiano do sistema discretizado}\label{S05-4}

Para aplicar o Filtro de Kalman Estendido no modelo dinâmico não linear \eqref{eq:SisSSg} é preciso obter o jacobiano $\frac{\partial \mgg}{\partial \mx_k}$ para o cálculo da estimativa a priori da matriz de covariância. Sendo assim, primeiramente definimos:

\begin{equation}
\mphi(\mx_k, \muu_k)= \frac{\partial \mgg}{\partial \mx_k}
\end{equation}

\begin{equation}
\mA_k = \frac{\partial \mff}{\partial \mx} (\mx_k, \muu_k)
\end{equation} 


Derivando \eqref{eq:g}, temos:

\begin{equation}
			\mphi_k = \frac{\partial \mgg}{\partial \mx_k} = \mone + \frac{T}{6} \Big( \frac{\partial \mk_{1|k}}{\partial \mx_k} + 2 \frac{\partial \mk_{2|k}}{\partial \mx_k}  + 2 \frac{\partial \mk_{3|k}}{\partial \mx_k}  + \frac{\partial \mk_{4|k}}{\partial \mx_k}  \Big)
		\end{equation}
		
Sendo:		
		\begin{equation}
			\frac{\partial \mk_{1|k}}{\partial \mx_k}  =  \frac{\partial \mff}{\partial \mx} (\mx_k, \muu_k)
		\end{equation}
		\begin{equation}
			\frac{\partial \mk_{2|k}}{\partial \mx_k}  =  \frac{\partial \mff}{\partial \mx} (\mx_k, \muu_k) \Big( 1 + \frac{T}{2} \frac{\partial \mk_{1|k}}{\partial \mx_k}  \Big)
		\end{equation}
		\begin{equation}
			\frac{\partial \mk_{3|k}}{\partial \mx_k}  =  \frac{\partial \mff}{\partial \mx} (\mx_k, \muu_k) \Big( 1 + \frac{T}{2} \frac{\partial \mk_{2|k}}{\partial \mx_k}  \Big)
		\end{equation}
		\begin{equation}
			\frac{\partial \mk_{4|k}}{\partial \mx_k}  =  \frac{\partial \mff}{\partial \mx} (\mx_k, \muu_k) \Big( 1 + T \frac{\partial \mk_{3|k}}{\partial \mx_k} \Big)
		\end{equation}
		
    	\begin{equation}
    		\mphi(\mx_k, \muu_k) = \frac{\partial \mgg}{\partial \mx_k} = \mone + T \cdot \mA_k + \frac{1}{2!}(T \cdot \mA_k)^2 + \frac{1}{3!}(T \cdot \mA_k)^3 + \frac{1}{4!}(T \cdot \mA_k)^4
    	\end{equation}
    	
%O jacobiano $\mphi_k = \frac{\partial \mgg}{\partial \mx_k}$ foi obtido em função do jacobiano $\mA = \frac{\partial \mff}{\partial \mx}$. Sendo assim, ainda é necessário obter $\mA$ em função dos termos da equação dinâmica do mecanismo serial \eqref{eq:MecSerial}. Este  será obtido na próxima subseção de forma implícita através da linearização da equação dinâmica \eqref{eq:MecSerial} e sua representação no espaço de estados linear \cite{CabralLIN}.


\subsection{Filtro de Kalman Estendido}\label{S05-5}

Sejam dois sistemas discretos, o da planta:

\begin{equation}
\begin{cases}
\mx_{k+1} = \mgg(\mx_k, \muu_k) \\
\my_{k+1} = \mhh(\mx_{k+1}) + \mv_{k+1} \\
\end{cases}
\end{equation}

e o do modelo da planta (com supostos erros de modelagem):

\begin{equation}
\begin{cases}
\hat{\mx}_{k+1} = \hat{\mgg}(\hat{\mx}_k, \muu_k) \\
\hat{\my}_{k+1} = \hat{\mhh}(\hat{\mx}_{k+1}) \\
\end{cases}
\end{equation}

Sendo $\mv_{k+1}$ o ruído de medição, assumido como um vetor de ruído branco gaussiano com média nula e covariância $\mR_{k+1}$. Além disso, considere um vetor $\mw_{k}$, relativo aos erros de modelagem do sistema, ou seja:
\begin{equation}
\mw_{k} =  \mgg(\mx_k, \muu_k) - \hat{\mgg}(\mx_k, \muu_k)
\end{equation}

$\mw_{k}$ será considerado como sendo um vetor de ruído branco gaussiano com média nula e covariância $\mQ_{k}$.  

Sejam $\hat{\mphi}$ e $\hat{\mC}$ os seguintes jacobianos do modelo da planta:
\begin{equation}
\hat{\mphi}(\hat{\mx}_k, \muu_k) = \frac{\partial \hat{\mgg}}{\partial\hat{\mx}_k}
\end{equation}
\begin{equation}
\hat{\mC}(\hat{\mx}_k, \muu_k) = \frac{\partial \hat{\mhh}}{\partial\hat{\mx}_k}
\end{equation}

E seja $\muu$ uma lei de controle do tipo:
\begin{equation}
\muu = \muuu(t, \hat{\mx})
\end{equation}

Aqui segue o algoritmo do Filtro de Kalman Estendido que será utilizado para realizar as simulações do sistema de interesse:

\begin{itemize}
\item Cálculo da lei de controle
\begin{equation}
\muu_k = \muuu(t_k, \hat{\mx}_k)
\end{equation}
\item Evolução temporal da planta e medição das saídas
\begin{equation}
\mx_{k+1} = \mg(\mx_k, \muu_k)
\end{equation}
\begin{equation}
\my_{k+1} = \mhh(\mx_{k+1}) + \mv_{k+1}
\end{equation}
\item Predição
		\begin{equation}
			\hat{\mphi}_{k} = \hat{\mphi}(\hat{\mx}_k^+, \muu_k)
		\end{equation}
		\begin{equation}
			\hat{\mx}_{k+1}^- = \hat{\mg}(\hat{\mx}_k^+, \muu_k)
		\end{equation}
		\begin{equation}
			\mP_{k+1}^- = \hat{\mphi}_{k} \mP_{k}^+ \hat{\mphi}_{k}^\msT + \mQ_k
		\end{equation}
\item Correção
\begin{equation}
			\hat{\mC}_{k+1} = \hat{\mC}(\hat{\mx}_{k+1}^-)
		\end{equation}
		\begin{equation}
			\tilde{\my}_{k+1} = \my_{k+1} - \hat{\mhh}(\hat{\mx}_{k+1}^-)
		\end{equation}
		\begin{equation}
			\mS_{k+1} = \hat{\mC}_{k+1}  \mP_{k+1}^-  \hat{\mC}_{k+1}^\msT + \mR_{k+1}
		\end{equation}
		\begin{equation}
			\mK_{k+1} = \left( ( \mS_{k+1}^\msT)^\msI  \cdot  ( \hat{\mC}_{k+1}  \mP_{k+1}^- ) \right)^\msT
		\end{equation}

		\begin{equation}
			\hat{\mx}_{k+1}^+ =  \hat{\mx}_{k+1}^- + \mK_{k+1} \tilde{\my}_{k+1}
		\end{equation}
		\begin{equation}
			\mP_{k+1}^+ =  (\mone - \mK_{k+1} \hat{\mC}_{k+1}) \mP_{k+1}^- (\mone - \mK_{k+1} \hat{\mC}_{k+1})^\msT
		\end{equation}
\end{itemize}
		

		
		
		
		
		
		\begin{multicols}{2}
			\begin{itemize}
				\item[-] $l_1 = 0.10 m$
				\item[-] $l_2 = 0.10 m$
				\item[-] $l_{g1} = 0.05 m$
				\item[-] $l_{g2} = 0.05 m$
				\item[-] $m_1 = 0.1 kg$
				\item[-] $m_2 = 0.1 kg$
				\item[-] $Jz_1 = 80.0 \cdot 10^{-6} kg\cdot m^2$
				\item[-] $Jz_2 = 80.0 \cdot 10^{-6} kg\cdot m^2$
				\item[-] $g = 9.8 m/s^2$
			\end{itemize}
		\end{multicols}
		
		\begin{multicols}{2}
			\begin{itemize}
				\item[-] $\hat{l}_1 = 0.0992 m$
				\item[-] $\hat{l}_2 = 0.0999 m$
				\item[-] $\hat{l}_{g1} = 0.0489 m$
				\item[-] $\hat{l}_{g2} = 0.0505 m$
				\item[-] $\hat{m}_1 = 0.0945 kg$
				\item[-] $\hat{m}_2 = 0.101 kg$
				\item[-] $\hat{J}z_1 = 80.8 \cdot 10^{-6} kg\cdot m^2$
				\item[-] $\hat{J}z_2 = 86.6 \cdot 10^{-6} kg\cdot m^2$
				\item[-] $\hat{g} = 9.8 m/s^2$
			\end{itemize}
		\end{multicols}
		
		$$
		\begin{cases}
			\theta_d(t) = -\frac{\pi}{2} +  \frac{\pi}{2} \sin(10 t) \\
			d_d(t) = 0.15 +  0.1 \sin(10 t) \\
		\end{cases}
		$$
		
		$$
		\begin{cases}
			\mq(0) = \hat{\mq}^-(0) = \mq_d(0) \\
			\dot{\mq}(0) = \mzr \\
			\dot{\hat{\mq}}^-(0) = \dot{\mq}_d(0) \\
			\mP^-(0) =
			\begin{bmatrix}
				247 & 0 & 0 & 0 \\
				0     & 1 & 0 & 0 \\
				0     & 0 & 1.57 \cdot 10^{-4} & 0 \\
				0     & 0 & 0               & 5 \cdot 10^{-4}
			\end{bmatrix} 
		\end{cases}
		$$
    	
		\begin{itemize}
			\item[--] $ k_v = 200 $  \\[8pt]
			\item[--] $ k_p = 10000 $ \\[8pt]
		\end{itemize}
		
			$$ \mQ = 
				\begin{bmatrix}
					1.57 \cdot 10^{-4} & 0 & 0 & 0 \\
					0     & 5 \cdot 10^{-4} & 0 & 0 \\
					0     & 0 & 0 & 0 \\
					0     & 0 & 0   & 0
				\end{bmatrix} $$
			$$ \mR = 
				\begin{bmatrix}
					1.57 \cdot 10^{-4} & 0\\
					0     & 5 \cdot 10^{-4} \\
				\end{bmatrix} $$


\section{Aplicação da técnica}\label{aplicacao}

À partir dos equacionamentos deduzidos anteriormente, será realizada a modelagem, projeto de controle por realimentação de estados, projeto de observador de ordem reduzida, e simulação de controle de trajetória de um mecanismo serial do tipo RP (figura \ref{fig:1}). \\

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{figures/RP.pdf}  
	\caption{Mecanismo RP}
	\label{fig:1}
\end{figure}

A modelagem do sistema será feita à partir do formalismo de Lagrange \cite{Lanczos,Tsai}.

Sejam $(x_1, y_1)$ e $(x_2, y_2)$ as coordenadas dos centros de massa dos elos 1 e 2, respectivamente. As energias cinética e potencial do sistema são dadas por:

\begin{equation} \label{eq:Ec}
E_c = \frac{1}{2} \Big( m_1 ( \dot{x}_1^2 + \dot{y}_1^2 ) + Jz_1 \dot{\theta}^2 + m_2 ( \dot{x}_2^2 + \dot{y}_2^2 ) + Jz_2 \dot{\theta}^2 \Big)
\end{equation}

\begin{equation} \label{eq:Ep}
E_p = -m_1 y_1 g - m_2 y_2 g
\end{equation}

Para aplicar o formalismo de Lagrange é preciso escrever as energias cinética e potencial em função de um conjunto mínimo de coordenadas generalizadas. Para esse sistema, definimos o seguinte conjunto mínimo de coordenadas generalizadas:

\begin{equation}
\mq = \begin{bmatrix}
\theta \\
d
\end{bmatrix}
\end{equation}

Realizando a cinemática de posição para os centros de massa, podemos escrever $x_1$, $y_1$, $x_2$ e $y_2$ em função de $\theta$ e $d$.

\begin{equation} \label{eq:cinPos}
\begin{cases} 
x_1 = l_{g1} \cos\theta \\
y_1 = l_{g1} \sin\theta \\
x_2 = (d - l_2 +l_{g2}) \cos\theta \\
y_2 = (d - l_2 +l_{g2}) \sin\theta \\
\end{cases}
\end{equation}

Derivando no tempo, temos:

\begin{equation} \label{eq:cinVel}
\begin{cases}
\dot{x}_1 = -l_{g1} \sin\theta \dot{\theta} \\
\dot{y}_1 = l_{g1} \cos\theta \dot{\theta} \\
\dot{x}_2 = -(d - l_2 +l_{g2}) \sin\theta\dot{\theta} + \dot{d} \cos\theta \\
\dot{y}_2 = (d - l_2 +l_{g2}) \cos\theta\dot{\theta} +  \dot{d} \sin\theta\\
\end{cases}
\end{equation}

Substituindo \eqref{eq:cinVel} em \eqref{eq:Ec} e \eqref{eq:Ep}, temos:

\begin{equation}
E_c(\mq,\dot{\mq}) = \frac{1}{2} \Big(   \big(Jz_1 + Jz_2 + m_1 l_{g1}^2 + m_2 (d - l_2 +l_{g2})^2 \big) \dot{\theta}^2 + m_2 \dot{d}^2 \Big)
\end{equation}

\begin{equation}
E_p(\mq) = - \big(m_1 l_{g1}  + m_2 (d -l_2 + l_{g2})\big) g \sin \theta 
\end{equation}

Sendo assim, definimos o Lagrangeano do sistema:

\begin{equation}
L(\mq, \dot{\mq}) = E_c(\mq, \dot{\mq}) - E_p(\mq)
\end{equation}

As equações de movimento do sistema são dadas por:

\begin{equation}
\frac{d}{dt} \Big( \frac{\partial L}{\partial \dot{\mq}} \Big) - \frac{\partial L}{\partial \mq} = \mtau
\end{equation}

Sendo $\mtau$ o vetor de esforços externos aplicados nas direções das coordenadas generalizadas, que no caso são os esforços dos atuadores. Calculando as derivadas do Lagrangeano:

\begin{equation}
\frac{\partial L}{\partial \dot{\mq}} = \begin{bmatrix}
(Jz_1 + Jz_2 + m_1 lg_1^2 + m_2 (d - l_2 + l_{g2})^2) \dot{\theta} \\
m_2 \dot{d}
\end{bmatrix}
\end{equation}

\begin{equation}
\frac{d}{dt} \Big( \frac{\partial L}{\partial \dot{\mq}} \Big) = \begin{bmatrix}
(Jz_1 + Jz_2 + m_1 lg_1^2 + m_2 (d - l_2 + l_{g2})^2) \ddot{\theta} + 2 m_2 (d-l_2+l_{g2}) \dot{\theta} \dot{d} \\
m_2 \ddot{d}
\end{bmatrix}
\end{equation}

\begin{equation}
\frac{\partial L}{\partial \mq} = \begin{bmatrix}
(m_1 l_{g1} + m_2 (d-l_2 + l_{g2}) ) g \cos \theta \\
m_2  (d-l_2+l_{g2})\dot{\theta}^2  + m_2 g \sin \theta
\end{bmatrix}
\end{equation}

Sendo assim, temos que o modelo dinâmico do sistema podem ser escrito no formato da equação \eqref{eq:MecSerial}, ou seja:

\begin{equation} \tag{\ref{eq:MecSerial}}
\mH(\mq) \ddot{\mq} + \mh(\mq, \dot{\mq}) = \mtau
\end{equation}

Sendo:

\begin{equation}
\mH(\mq) = \begin{bmatrix}
Jz_1 + Jz_2 + m_1 lg_1^2 + m_2 (d - l_2 + l_{g2})^2 & 0 \\
0 & m_2
\end{bmatrix}
\end{equation}

\begin{equation}
\mh(\mq, \dot{\mq}) = \begin{bmatrix}
2 m_2 (d-l_2+l_{g2}) \dot{\theta} \dot{d} - (m_1 l_{g1} + m_2 (d-l_2 + l_{g2}) ) g \cos \theta \\
-m_2  (d-l_2+l_{g2})\dot{\theta}^2  - m_2 g \sin \theta
\end{bmatrix}
\end{equation}

Tendo obtido $\mH(\mq)$ e $\mh(\mq, \dot{\mq})$, podemos calcular as matrizes $\mM(t)$, $\mV(t)$ e $\mG(t)$ do sistema linearizado à partir das equações \eqref{eq:M}, \eqref{eq:V} e \eqref{eq:G}:  

\begin{equation}
\mM(t) = \begin{bmatrix}
Jz_1 + Jz_2 + m_1 lg_1^2 + m_2 (d_d(t) - l_2 + l_{g2})^2 & 0 \\
0 & m_2
\end{bmatrix}
\end{equation}

\begin{equation}
\mV(t) = \begin{bmatrix}
2 m_2 (d_d(t) -l_2+l_{g2}) \dot{d}_d(t) & 2 m_2 (d_d(t) -l_2+l_{g2}) \dot{\theta}_d(t) \\
-2 m_2 (d_d(t) -l_2+l_{g2}) \dot{\theta}_d(t) & 0
\end{bmatrix}
\end{equation}

\small
\begin{equation}
\mG(t) = \begin{bmatrix}
 \big( m_1 l_{g1}  + m_2 ( d_d(t) -l_2 + l_{g2})\big) g \sin \theta_d(t) & m_2 \left(2 \dot{d}_d(t) \dot{\theta}_d(t)+2  (d_d(t)-l_2+l_{g2})\ddot{\theta}_d(t) -g \cos \theta_d(t)\right) \\
-m_2 g \cos\theta_d(t) & -m_2 \dot{\theta}_d^2(t)
\end{bmatrix}
\end{equation}
\normalsize

A partir de $\mM(t)$, $\mV(t)$ e $\mG(t)$, obtemos $\mA_{1,1}(t)$, $\mA_{1,2}(t)$, $\mB_1(t)$, $\mK(t)$ e $\mL(t)$ através de \eqref{eq:A11}, \eqref{eq:A12}, \eqref{eq:B1}, \eqref{eq:K} e \eqref{eq:L}. \\

Além disso, para realizar a simulação do sistema precisamos de $\mtau_d(t)$, a qual é dada pela equação \eqref{eq:tau_d} e depende das matrizes $\mM(t)$ e $\mh^*(t)$, sendo a última dada por:
\begin{equation}
\mh^*(t) = \begin{bmatrix}
2 m_2 (d_d(t)-l_2+l_{g2}) \dot{\theta}_d(t) \dot{d}_d(t) - (m_1 l_{g1} + m_2 (d_d(t)-l_2 + l_{g2}) ) g \cos \theta_d(t) \\
-m_2  (d-l_2+l_{g2})\dot{\theta}_d^2(t)  - m_2 g \sin \theta_d^2(t)
\end{bmatrix}
\end{equation}

A simulação do sistema será feita a partir da solução do seguinte sistema de equações algébrico-diferenciais:

\begin{equation}
\begin{cases}
\mH(\mq) \ddot{\mq} + \mh(\mq, \dot{\mq}) = \mtau \\
\mtau = \mtau_d(t) + \muu \\
\mtau_d(t) = \mM (t) \cdot  \ddot{\mq}_d(t) + \mh^*(t) \\
\muu = -\mK(t) \cdot \hat{\mx} \\
\hat{\mx}
=
 \begin{bmatrix}
\hat{\mv} + \mL \cdot \my \\
\my
\end{bmatrix} \\
\dot{\hat{\mv}}   = (\mA_{1,1} - \mL \mA_{2,1} )\hat{\mv} + (\mA_{1,1}\mL - \mL \mA_{2,1}\mL + \mA_{1,2} - \mL\mA_{2,2}  -  \dot{\mL})\my + (\mB_1 - \mL \mB_2) \muu \\
\my = \mq - \mq_d(t)
\end{cases}
\end{equation}

Definindo os seguintes valores para os parâmetros do sistema:
\begin{multicols}{2}
\begin{itemize}
\item[-] $l_1 = 0.1 m$ 
\item[-] $l_2 = 0.1 m$
\item[-] $l_{g1} = 0.05 m$
\item[-] $l_{g2} = 0.05 m$ 
\item[-] $m_1 = 0.1 kg$ 
\item[-] $m_2 = 0.1 kg$ 
\item[-] $Jz_1 = 80.0 \cdot 10^{-6} kg \, m^2$ 
\item[-] $Jz_2 = 80.0 \cdot 10^{-6} kg \, m^2$ 
\item[-] $g = 9.8 m/s^2$
\end{itemize}
\end{multicols}

Os parâmetros $k_p$ e $k_v$ do controlador são escolhidos do modo a alocar os pólos do sistema em malha fechada em $s = -100 rad/s$ (amortecimento crítico). Sendo assim, temos:
\begin{equation}
k_p = 100^2 (rad/s)^2 = 10000 (rad/s)^2
\end{equation}
\begin{equation}
k_v = 2 \cdot 100 rad/s = 200 rad/s
\end{equation}

O parâmetro $\alpha$ do observador é escolhido de modo que os pólos do observador tenham uma dinâmica 3 vezes mais rápida que os pólos do sistema em malha fechada, ou seja, em $s = -300rad/s$. Sendo assim, temos:
\begin{equation}
\alpha = 300 rad/s
\end{equation}

Definindo a seguinte trajetória de referência:
\begin{equation}
\mq_d(t) = \begin{bmatrix}
\theta_d(t) \\
d_d(t) 
\end{bmatrix}
= \begin{bmatrix}
\pi \sin(20 t) \\
0.15 + 0.05\sin(20t)
\end{bmatrix} 
\end{equation}

E as seguintes condições iniciais:
\begin{equation}
\mq(0) = \begin{bmatrix}
\theta(0) \\
d(0) 
\end{bmatrix}
= \begin{bmatrix}
0.0 \\
0.15 
\end{bmatrix}
\end{equation}
\begin{equation}
\dot{\mq}(0) = \begin{bmatrix}
\dot{\theta}(0) \\
\dot{d}(0) 
\end{bmatrix}
= \begin{bmatrix}
0 \\
0 
\end{bmatrix}
\end{equation}
\begin{equation}
\hat{\mv}(0) = \begin{bmatrix}
1 \\
1 
\end{bmatrix}
\end{equation}

Sendo assim, obtemos os seguintes resultados: (figuras \ref{fig:2}, \ref{fig:3}, \ref{fig:4}, \ref{fig:5} e \ref{fig:6})

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.6]{figures/e_theta_orig.pdf}  
	\caption{Erro de controle $\Delta\theta$ em função do tempo}
	\label{fig:2}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.6]{figures/e_d_orig.pdf}  
	\caption{Erro de controle $\Delta d$  em função do tempo}
	\label{fig:3}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.6]{figures/w1_orig.pdf}  
	\caption{$\Delta\dot{\theta}$ real (em azul) e estimado (em beje) em função do tempo}
	\label{fig:4}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.6]{figures/w2_orig.pdf}  
	\caption{$\Delta\dot{d}$ real (em azul) e estimado (em beje) em função do tempo}
	\label{fig:5}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.6]{figures/theta_orig.pdf}  
	\caption{Coordenada $\theta$ em função do tempo}
	\label{fig:6}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.6]{figures/d_orig.pdf}  
	\caption{Coordenada $d$ em função do tempo}
	\label{fig:7}
\end{figure}

Como podemos perceber, os erros de controle e de observação vão a zero assintóticamente. Realizando a mesma simulação, agora com erro de controle não nulo em $t=0$, mudando as condições iniciais para

\begin{equation}
\mq(0) = \begin{bmatrix}
0.1 \\
0.16
\end{bmatrix}
\end{equation}

obtemos os seguintes resultados: (figuras \ref{fig:8}, \ref{fig:9}, \ref{fig:10}, \ref{fig:11}, \ref{fig:12} e \ref{fig:13})

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.6]{figures/e_theta.pdf}  
	\caption{Erro de controle $\Delta\theta$ em função do tempo}
	\label{fig:8}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.6]{figures/e_d.pdf}  
	\caption{Erro de controle $\Delta d$  em função do tempo}
	\label{fig:9}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.6]{figures/w1.pdf}  
	\caption{$\Delta\dot{\theta}$ real (em azul) e estimado (em beje) em função do tempo}
	\label{fig:10}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.6]{figures/w2.pdf}  
	\caption{$\Delta\dot{d}$ real (em azul) e estimado (em beje) em função do tempo}
	\label{fig:11}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.6]{figures/theta.pdf}  
	\caption{Coordenada $\theta$ em função do tempo}
	\label{fig:12}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.6]{figures/d.pdf}  
	\caption{Coordenada $d$ em função do tempo}
	\label{fig:13}
\end{figure}

%\begin{equation}
%\frac{2 m_2 \left(-\ddot{d}_d (d_d-l_2+l_{g2}) \left(m_2 (d_d-l_2+l_{g2})^2+Jz_1+Jz_2+l_{g1}^2 m_1\right)-\dot{d}_d^2 \left(Jz_1+Jz_2+l_{g1}^2 m_1 - m_2 (d_d-l_2+l_{g2})^2 \right)\right)}{\left(m_2 (d_d-l_2+l_{g2})^2+Jz_1+Jz_2+l_{g1}^2 m_1\right)^2}
%\end{equation}


%---CONCLUSÕES---------------------------------------------------------
\section{Conclusões}\label{concl}

A partir dos resultados obtidos, foi possível constatar que o controlador e observador projetados desempenham bem as funções pelas quais foram projetados, visto que o erro de controle e o erro de observação vão a zero assintoticamente, mesmo partindo de condições iniciais não nulas.


%\newpage

\phantom{a}
\bibliographystyle{plain}
\bibliography{bibliografia}

\end{document}\grid
\grid
